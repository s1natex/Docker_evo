<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Password-Generator</title>
    <style>
      :root{--bg:#0b0f14;--card:rgba(255,255,255,0.06);--card-border:rgba(255,255,255,0.12);--text:#e7eef7;--muted:#9db0c5;--accent:#6ee7f9;--accent-2:#7c6dfb;--ok:#38d39f;--warn:#ffb454;--err:#ff6b6b;--shadow:0 10px 30px rgba(0,0,0,.35);--radius:16px}
      @media (prefers-color-scheme: light){:root{--bg:#f5f7fb;--card:rgba(255,255,255,0.9);--card-border:rgba(17,24,39,0.06);--text:#0f172a;--muted:#44546b;--accent:#0ea5e9;--accent-2:#7c3aed;--shadow:0 12px 28px rgba(2,8,23,.08)}}
      *{box-sizing:border-box;margin:0;padding:0}
      html,body{height:100%;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans"}
      body{display:flex;background:var(--bg);color:var(--text);justify-content:center;align-items:center;padding:32px}
      .container{display:flex;gap:0;max-width:1200px;width:100%}
      aside{width:300px;background:var(--card);border:1px solid var(--card-border);border-radius:var(--radius) 0 0 var(--radius);box-shadow:var(--shadow);padding:16px;overflow-y:auto}
      aside h2{font-size:1.1rem;margin-bottom:12px;color:var(--accent)}
      .saved-item{padding:10px;border:1px solid var(--card-border);border-radius:10px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;gap:8px;background:rgba(255,255,255,0.04)}
      .saved-item div{flex:1}
      .saved-item small{display:block;color:var(--muted);font-size:.8rem}
      .btn-mini{background:transparent;border:1px solid var(--card-border);color:var(--text);padding:4px 8px;border-radius:8px;cursor:pointer;font-size:.8rem;transition:transform .05s ease,filter .15s ease}
      .btn-mini:active{transform:translateY(1px)}
      main{flex:1;background:var(--card);border:1px solid var(--card-border);border-left:none;border-radius:0 var(--radius) var(--radius) 0;box-shadow:var(--shadow);backdrop-filter:blur(10px);overflow:hidden;animation:pop .35s ease-out}
      @keyframes pop{from{transform:translateY(6px);opacity:0}to{transform:translateY(0);opacity:1}}
      .header{padding:28px 28px 12px;display:flex;align-items:center;gap:12px}
      .logo{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:0 8px 20px rgba(108,108,255,.35),inset 0 0 20px rgba(255,255,255,.25)}
      h1{margin:0;font-size:clamp(1.35rem,1rem + 1.2vw,1.75rem)}
      .sub{color:var(--muted);padding:0 28px 8px;font-size:.95rem}
      .controls{padding:8px 28px 24px;display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
      .field{grid-column:span 12;display:flex;align-items:center;gap:12px;background:rgba(255,255,255,0.04);border:1px solid var(--card-border);border-radius:12px;padding:12px 14px}
      .field.compact{grid-column:span 12}
      @media (min-width:640px){.field.compact{grid-column:span 6}}
      label{color:var(--muted);font-size:.95rem}
      input[type="number"]{width:100%;max-width:120px;padding:10px 12px;border-radius:10px;border:1px solid var(--card-border);background:transparent;color:var(--text);font-size:1rem;outline:none}
      input[type="checkbox"]{accent-color:var(--accent);width:18px;height:18px}
      input[type="range"]{width:100%}
      .entropy{padding:0 28px 8px;display:flex;gap:10px;align-items:center;font-size:.95rem;color:var(--muted)}
      .badge{padding:4px 10px;border-radius:999px;font-weight:700}
      .b-bad{background:rgba(255,107,107,.18);color:#fecaca}
      .b-warn{background:rgba(255,180,84,.18);color:#fde68a}
      .b-ok{background:rgba(56,211,159,.18);color:#bbf7d0}
      .actions{display:flex;gap:12px;padding:0 28px 28px;flex-wrap:wrap}
      .btn{appearance:none;border:none;padding:12px 16px;border-radius:12px;font-weight:600;cursor:pointer;transition:transform .05s ease,filter .15s ease,opacity .2s ease;display:inline-flex;align-items:center;gap:10px;user-select:none}
      .btn:active{transform:translateY(1px)}
      .btn-primary{color:#06131a;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:0 10px 24px rgba(110,231,249,.25)}
      .btn-ghost{color:var(--text);background:transparent;border:1px solid var(--card-border)}
      .output-wrap{margin:0 28px 28px;background:rgba(255,255,255,0.04);border:1px solid var(--card-border);border-radius:12px;padding:12px;display:grid;grid-template-columns:1fr auto auto;align-items:center;gap:10px}
      #output{padding:10px 12px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;font-size:1.05rem;word-break:break-all;min-height:1.8em}
      .copy,.use{padding:10px 14px;border-radius:10px;border:1px solid var(--card-border);background:rgba(255,255,255,0.05);color:var(--text);cursor:pointer;transition:transform .06s ease,filter .12s ease}
      .copy:active,.use:active{transform:translateY(1px)}
      #saveWindow{display:none;padding:20px;border-top:1px solid var(--card-border);background:rgba(255,255,255,0.03)}
      #saveWindow input{width:100%;padding:10px;border-radius:8px;border:1px solid var(--card-border);margin-bottom:12px;background:transparent;color:var(--text)}
      .foot{padding:0 28px 28px;color:var(--muted);font-size:.9rem}
      .toast{position:fixed;right:18px;bottom:18px;background:rgba(14,20,43,.96);border:1px solid rgba(255,255,255,.1);padding:12px 14px;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,.4);opacity:0;transform:translateY(8px);transition:all .18s;color:#e8ebf0}
      .toast.show{opacity:1;transform:translateY(0)}
    </style>
  </head>
  <body>
    <div class="container">
      <aside>
        <h2>Saved Passwords</h2>
        <div id="savedList"></div>
      </aside>

      <main>
        <div class="header">
          <div class="logo"></div>
          <div><h1>Password-Generator</h1></div>
        </div>
        <p class="sub">Generate strong, random passwords in one click.</p>

        <section class="controls">
          <div class="field">
            <label for="lengthRange">Length</label>
            <input id="lengthRange" type="range" min="8" max="128" value="16" step="1" />
            <input id="length" type="number" min="8" max="128" value="16" />
          </div>
          <div class="field compact"><label><input id="digits" type="checkbox" checked /> Digits</label></div>
          <div class="field compact"><label><input id="symbols" type="checkbox" checked /> Symbols</label></div>
          <div class="field compact"><label><input id="uppercase" type="checkbox" checked /> Uppercase</label></div>
        </section>

        <div class="entropy">
          <span id="entropyBits">0 bits</span>
          <span id="entropyBadge" class="badge b-warn">medium</span>
        </div>

        <section class="actions">
          <button id="gen" class="btn btn-primary">Generate Password</button>
          <button id="reset" class="btn btn-ghost">Reset</button>
        </section>

        <section class="output-wrap">
          <div id="output"></div>
          <button id="copy" class="copy">Copy</button>
          <button id="use" class="use">Use</button>
        </section>

        <div id="saveWindow">
          <input id="saveName" type="text" placeholder="Enter name for password" />
          <div style="display:flex;gap:10px;">
            <button id="saveBtn" class="btn btn-primary">Save</button>
            <button id="backBtn" class="btn btn-ghost">Back</button>
          </div>
        </div>

        <p class="foot">Tip: tweak options for different sitesâ€™ requirements.</p>
        <div id="toast" class="toast">Copied</div>
      </main>
    </div>

    <script>
      const $=id=>document.getElementById(id);
      const out=$("output"),toast=$("toast"),saveWindow=$("saveWindow");
      const len=$("length"),range=$("lengthRange"),digits=$("digits"),symbols=$("symbols"),uppercase=$("uppercase"),listEl=$("savedList");

      function clamp(v,min,max){return Math.max(min,Math.min(max,v))}
      function charsetSize(){let n=26;if(uppercase.checked)n+=26;if(digits.checked)n+=10;if(symbols.checked)n+=32;return n}
      function entropyBits(){const n=charsetSize();const L=clamp(parseInt(len.value,10)||16,8,128);return Math.round(L*Math.log2(n))}
      function strength(b){if(b<50)return["weak","b-bad"];if(b<80)return["medium","b-warn"];return["strong","b-ok"]}
      function updateEntropy(){const b=entropyBits();const s=strength(b);$("entropyBits").textContent=`${b} bits`;$("entropyBadge").textContent=s[0];$("entropyBadge").className=`badge ${s[1]}`}
      function showToast(m){toast.textContent=m;toast.classList.add("show");setTimeout(()=>toast.classList.remove("show"),1200)}
      function pulse(el){el.classList.add("pressed");setTimeout(()=>el.classList.remove("pressed"),120)}

      async function generate(){
        const L=clamp(parseInt(len.value,10)||16,8,128);
        len.value=String(L);range.value=String(L);
        const params=new URLSearchParams({length:String(L),digits:String(digits.checked),symbols:String(symbols.checked),uppercase:String(uppercase.checked)});
        try{
          const r=await fetch("/api/generate?"+params.toString());
          const d=await r.json();
          const pwd=(d.password||"").toString();
          out.textContent=pwd.slice(0,L);
        }catch{out.textContent="Error"}
      }

      $("gen").onclick=async()=>{await generate();updateEntropy()}
      $("reset").onclick=()=>{out.textContent=""}
      $("copy").onclick=async(e)=>{pulse(e.currentTarget);const t=out.textContent.trim();if(!t)return;await navigator.clipboard.writeText(t);showToast("Copied")}
      $("use").onclick=(e)=>{pulse(e.currentTarget);if(!out.textContent.trim())return;toggleSaveWindow(true);$("saveName").focus()}
      $("backBtn").onclick=()=>toggleSaveWindow(false)

      $("saveBtn").onclick=async()=>{
        const name=$("saveName").value.trim(),pwd=out.textContent.trim();
        if(!name||!pwd){showToast("Missing name or password");return;}
        await fetch("/api/passwords",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name,password:pwd})});
        out.textContent="";$("saveName").value="";toggleSaveWindow(false);loadPasswords();showToast("Saved");
      }

      function toggleSaveWindow(show){saveWindow.style.display=show?"block":"none"}

      len.oninput=()=>{range.value=len.value;updateEntropy()}
      range.oninput=()=>{len.value=range.value;updateEntropy()}
      ;[digits,symbols,uppercase].forEach(el=>el.addEventListener("change",updateEntropy))

      async function loadPasswords(){
        try{
          const r=await fetch("/api/passwords");
          const data=await r.json();
          listEl.innerHTML="";
          data.forEach(p=>{
            const div=document.createElement("div");div.className="saved-item";
            const info=document.createElement("div");
            const title=document.createElement("strong");title.textContent=p.name;
            const small=document.createElement("small");
            const date=new Date(p.created_at);
            small.textContent=isNaN(date)?p.created_at:date.toLocaleString();
            info.appendChild(title);info.appendChild(small);
            const copy=document.createElement("button");copy.className="btn-mini";copy.textContent="Copy";
            const del=document.createElement("button");del.className="btn-mini";del.textContent="Del";
            copy.onclick=async()=>{await navigator.clipboard.writeText(p.password||"");showToast("Copied")};
            del.onclick=async()=>{await fetch("/api/passwords/"+p.id,{method:"DELETE"});loadPasswords();showToast("Deleted")};
            div.append(info,copy,del);listEl.appendChild(div);
          });
        }catch{}
      }

      (async()=>{updateEntropy();await generate();await loadPasswords()})();
    </script>
  </body>
</html>
